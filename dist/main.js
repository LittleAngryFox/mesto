(()=>{"use strict";var e={formSelector:".popup__container",inputSelector:".popup__input",setSelector:".popup__input-container",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-error",errorClass:"popup__input-error_active",popupPlaceholder:".popup__placeholder"},t=document.querySelector(".content").querySelector(".profile"),n=t.querySelector(".profile__edit-button"),r=t.querySelector(".profile__add-button"),o=t.querySelector(".profile__photo-update-button"),i=t.querySelector(".profile__photo"),u=document.querySelector(".popup__container_edit"),a=document.querySelector(".popup__container_add"),c=document.querySelector(".popup__container_update-avatar"),s=document.querySelector(".popup_edit-profile").querySelector(".popup__input_heading"),l=document.querySelector(".popup_edit-profile").querySelector(".popup__input_subheading"),p=document.querySelector(".popup_add").querySelector(".popup__input_picture"),f=document.querySelector(".popup_add").querySelector(".popup__input_imgurl"),h=document.querySelector(".popup_update-avatar").querySelector(".popup__input_imgurl");function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t,n,r,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._title=t.name,this._image=t.link,this._countlike=t.likes.length,this._like=t.likes,this._isLike=!1,this._id=t._id,this._ownerid=t.owner._id,this._cardSelector=i,this._handleCardClick=n,this._handleDeleteClick=r,this._handleLikeClick=o}var t,n;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".elements__item").cloneNode(!0)}},{key:"_activeMyLike",value:function(){var e=this;this._like.forEach((function(t){t._id==e._myId&&e._likeButton.classList.add("element__like-button_active")}))}},{key:"stateLikeButton",value:function(){return this._likeButton.classList.contains("element__like-button_active")}},{key:"activeLike",value:function(){this._likeButton.classList.add("element__like-button_active"),this._elementLike.textContent++}},{key:"disableLike",value:function(){this._likeButton.classList.remove("element__like-button_active"),this._elementLike.textContent--}},{key:"_activeRemoveCard",value:function(){this._ownerid!=this._myId&&this._element.querySelector(".element__remove").remove()}},{key:"generateCard",value:function(e){return this._myId=e,this._element=this._getTemplate(),this._elementImg=this._element.querySelector(".element__img"),this._elementLike=this._element.querySelector(".element__like-count"),this._element.id=this._id,this._elementImg.src=this._image,this._elementImg.alt=this._title,this._elementLike.textContent=this._countlike,this._likeButton=this._element.querySelector(".element__like-button"),this._removeButton=this._element.querySelector(".element__remove"),this._activeMyLike(),this._activeRemoveCard(),this._setEventListeners(),this._element.querySelector(".element__title").textContent=this._title,this._element}},{key:"_handleMessageClickLike",value:function(){this._handleLikeClick()}},{key:"_handleMessageClickRemove",value:function(){this._handleDeleteClick(this._element)}},{key:"deleteCard",value:function(){this._element.remove(),this._element=null}},{key:"_handleMessageClickImage",value:function(){this._handleCardClick(this._image,this._title)}},{key:"_setEventListeners",value:function(){var e=this;this._likeButton.addEventListener("click",(function(){e._handleMessageClickLike()})),this._removeButton.addEventListener("click",(function(){e._handleMessageClickRemove()})),this._elementImg.addEventListener("click",(function(){e._handleMessageClickImage()}))}}])&&_(t.prototype,n),e}();function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._setSelector=t.setSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._popupPlaceholder=t.popupPlaceholder,this._formValidator=n,this._fieldset=null}var t,n;return t=e,(n=[{key:"enableValidation",value:function(){this._formValidator.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}},{key:"_setEventListeners",value:function(){var e=this;this._inputList=Array.from(this._formValidator.querySelectorAll(this._inputSelector)),this._buttonElement=this._formValidator.querySelector(this._submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?this.disabledButton():this.activeButtonDefault()}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_showInputError",value:function(e){var t=this._formValidator.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){var t=this._formValidator.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}},{key:"activeButtonDefault",value:function(){this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1}},{key:"disabledButton",value:function(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0}},{key:"removeErrorField",value:function(){var e=this;this._inputList.forEach((function(t){return e._hideInputError(t)}))}}])&&y(t.prototype,n),e}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(t,n){var r=t.data,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){return t._renderer(e)}))}},{key:"addItem",value:function(e,t){switch(t){case"append":this._container.append(e);break;case"prepend":this._container.prepend(e)}}}])&&v(t.prototype,n),e}();function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupForm=document.querySelector(t)}var t,n;return t=e,(n=[{key:"openPopup",value:function(){this._popupForm.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose.bind(this)),document.addEventListener("mousedown",this._closeOverlayPopup.bind(this))}},{key:"closePopup",value:function(){this._popupForm.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose.bind(this)),document.removeEventListener("mousedown",this._closeOverlayPopup.bind(this))}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.closePopup()}},{key:"_closeOverlayPopup",value:function(e){e.target.classList.contains("popup")&&this.closePopup()}},{key:"setEventListeners",value:function(){var e=this;this._popupForm.querySelector(".popup__close-button").addEventListener("click",(function(){e.closePopup()}))}}])&&k(t.prototype,n),e}();function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(r);if(o){var n=P(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return C(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._popupForm=document.querySelector(e),t}return t=u,(n=[{key:"openPopup",value:function(e,t){var n=this._popupForm.querySelector(".popup__img-item"),r=this._popupForm.querySelector(".popup__caption");n.src=e,r.textContent=t,n.alt=t,L(P(u.prototype),"openPopup",this).call(this)}}])&&E(t.prototype,n),u}(g);function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(t){var n=t.selectorUserName,r=t.selectorUserDescription,o=t.selectorAvatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userName=document.querySelector(n),this._userDescription=document.querySelector(r),this._userAvatar=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._userName.textContent,description:this._userDescription.textContent}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about;this._userName.textContent=t,this._userDescription.textContent=n}},{key:"renderUserInfo",value:function(e){var t=e.name,n=e.about,r=e.avatar,o=e._id;this._userName.textContent=t,this._userDescription.textContent=n,this._userAvatar.src=r,this._myId=o}},{key:"getmyId",value:function(){return this._myId}}])&&q(t.prototype,n),e}();function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t,n){return(x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(a,t);var n,r,o,i,u=(o=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(o);if(i){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return D(this,e)});function a(t){var n,r=t.selectorPopup,o=t.formSubmitHandler;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=u.call(this,r))._formElement=document.querySelector(r).querySelector(e.formSelector),n._formSubmitHandler=o,n}return n=a,(r=[{key:"_getInputValues",value:function(){var t=this;return this._inputList=this._formElement.querySelectorAll(e.inputSelector),this._formValues={},this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"setUserInfoForm",value:function(e){var t=e.heading,n=e.subheading;this._userName.textContent=t,this._userDescription.textContent=n}},{key:"waitLoad",value:function(e){this._buttonWhitText=this._formElement.querySelector(".popup__button"),this._firstText=this._buttonWhitText.textContent,this._buttonWhitText.textContent=e}},{key:"endLoad",value:function(){this._buttonWhitText.textContent=this._firstText}},{key:"setEventListeners",value:function(){var e=this;x(U(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(t){t.preventDefault(),e._formSubmitHandler(e._getInputValues())}))}},{key:"closePopup",value:function(){x(U(a.prototype),"closePopup",this).call(this,this),this._formElement.reset()}}])&&j(n.prototype,r),a}(g);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t,n){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=N(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t){return!t||"object"!==V(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var W=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(a,t);var n,r,o,i,u=(o=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=N(o);if(i){var n=N(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return M(this,e)});function a(t){var n,r=t.selectorPopup,o=t.formSubmitHandler;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=u.call(this,r))._formElement=document.querySelector(r).querySelector(e.formSelector),n._formSubmitHandler=o,n}return n=a,(r=[{key:"setEventListeners",value:function(){var e=this;H(N(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(t){t.preventDefault(),e._formSubmitHandler()}))}}])&&F(n.prototype,r),a}(g);function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}},{key:"getInitialCards",value:function(){var e=this;return fetch(this._baseUrl+"/cards",{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"getUserInfo",value:function(){var e=this;return fetch(this._baseUrl+"/users/me",{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"patchUserInfo",value:function(e){var t=this,n=e.name,r=e.about;return fetch(this._baseUrl+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return t._checkResponse(e)}))}},{key:"patchUserAvatar",value:function(e){var t=this,n=e.avatar;return fetch(this._baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:n})}).then((function(e){return t._checkResponse(e)}))}},{key:"postCard",value:function(e){var t=this,n=e.name,r=e.link;return fetch(this._baseUrl+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return t._checkResponse(e)}))}},{key:"deleteMyCard",value:function(e){var t=this;return fetch(this._baseUrl+"/cards/"+e,{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"activeLike",value:function(e){var t=this;return fetch(this._baseUrl+"/cards/likes/"+e,{method:"PUT",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"deleteLike",value:function(e){var t=this;return fetch(this._baseUrl+"/cards/likes/"+e,{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}}])&&J(t.prototype,n),e}(),G=new O(".popup_image"),K=function(e,t){return G.openPopup(e,t)},Q=function(e){ee.card=e,ee.openPopup()},X=new b({data:[],renderer:function(e){te(e,"append")}},".elements__list"),Y=new z({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-17",headers:{authorization:"ad8091c0-2087-4b81-9f1c-48d02b521a18","Content-Type":"application/json"}}),Z=new I({selectorUserName:".profile__title",selectorUserDescription:".profile__subtitle",selectorAvatar:".profile__photo"});Y.getUserInfo().then((function(e){Z.renderUserInfo(e)})).catch((function(e){console.log(e)}));var $=new T({selectorPopup:".popup_edit-profile",formSubmitHandler:function(e){$.waitLoad("Сохранение..."),Y.patchUserInfo({name:e.heading,about:e.subheading}).then((function(e){Z.setUserInfo(e),$.closePopup(),oe.removeErrorField()})).catch((function(e){$.endLoad(),console.log(e)})).finally((function(){$.endLoad()}))}});Y.getInitialCards().then((function(e){X.renderItems(e)})).catch((function(e){console.log(e)}));var ee=new W({selectorPopup:".popup_delete-confirmation",formSubmitHandler:function(){Y.deleteMyCard(ee.card.id).then((function(e){document.getElementById(ee.card.id).remove()})).then((function(){ee.closePopup()})).catch((function(e){console.log(e)}))}}),te=function(e,t){var n=new d(e,K,Q,(function(){n.stateLikeButton()?Y.deleteLike(n._id).then((function(){n.disableLike()})).catch((function(e){console.log(e)})):Y.activeLike(n._id).then((function(){n.activeLike()})).catch((function(e){console.log(e)}))}),".card__template"),r=n.generateCard(Z.getmyId());X.addItem(r,t)},ne=new T({selectorPopup:".popup_update-avatar",formSubmitHandler:function(e){ne.waitLoad("Сохранение..."),Y.patchUserAvatar({avatar:e.imgurl}).then((function(e){i.src=e.avatar,ne.closePopup(),ue.removeErrorField()})).catch((function(e){ne.endLoad(),console.log(e)})).finally((function(){ne.endLoad()}))}}),re=new T({selectorPopup:".popup_add",formSubmitHandler:function(e){re.waitLoad("Создание..."),Y.postCard({name:e["name-picture"],link:e.imgurl}).then((function(e){te(e,"prepend"),re.closePopup()})).catch((function(e){console.log(e),re.endLoad()})).finally((function(){re.endLoad()}))}});o.addEventListener("click",(function(e){e.preventDefault(),ue.disabledButton(),ue.removeErrorField(),h.value="",ne.openPopup()})),n.addEventListener("click",(function(e){e.preventDefault();var t=Z.getUserInfo();s.value=t.name,l.value=t.description,oe.activeButtonDefault(),oe.removeErrorField(),$.openPopup()})),r.addEventListener("click",(function(e){e.preventDefault(),ie.disabledButton(),ie.removeErrorField(),f.value="",p.value="",re.openPopup()})),re.setEventListeners(),$.setEventListeners(),G.setEventListeners(),ne.setEventListeners(),ee.setEventListeners();var oe=new m(e,u),ie=new m(e,a),ue=new m(e,c);oe.enableValidation(),ie.enableValidation(),ue.enableValidation()})();